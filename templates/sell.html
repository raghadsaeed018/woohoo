{% extends "layout.html" %}

{% block title %}
    Sell
{% endblock %}

{% block main %}
    <div class="container container-fluid py-5">
        <div class="mx-auto text-center mb-4">
            <label for="petSelect" class="form-label text-bg-secondary fs-4 snugglez rounded w-50">Select a Pet</label>
        </div>
        <div class="row mx-auto text-center">
            <!-- Form and Button Column -->
            <div class="col-lg-6 col-md-8 col-sm-10 col-xs-12">
                <form action="/sell" method="post">
                    <div class="m-4">
                        <select class="form-select mx-auto w-auto" name="pet" id="petSelect">
                            <option disabled selected>Pet</option>
                            {% for pet in pets %}
                                <option value="{{ pet['id'] }}">{{ pet["name"] }}</option>
                            {% endfor %}
                        </select>
                        <input type="hidden" name="animal_id" id="animalIdInput" value="">
                    </div>
            
                    <div class="text-center mb-3">
                        <button class="btn btn-primary" type="submit">Sell</button>
                    </div>
                </form>
            </div>

            <!-- Card Column -->
            <div class="col-lg-4 col-md-3 col-sm-2 col-xs-12">
                <div id="petDetails" style="display: none;">
                    <div class="card mb-3 mt-3 text-center">
                        <img class="card-img-top aspect-ratio-16x9" id="petImage" alt="Pet image">
                        <div class="card-body">
                            <h5 class="card-title" id="petName"></h5>
                            <p class="card-text" id="petDescription"></p>
                        </div>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item text-bg-light" id="petPrice"></li>
                        </ul>
                    </div>
                </div>
                <div id="emptyCard" class="card mb-3 mt-3 text-center">
                    <div class="card-body">
                        <p class="card-text">A preview of your selected pet will appear here.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        $(document).ready(function () {
        $("#petSelect").change(function () {
            var selectedPetId = $(this).val();
            $("#animalIdInput").val(selectedPetId);

            if (selectedPetId) {
                $.ajax({
                    url: "/get_pet_details/" + selectedPetId,
                    method: "GET",
                    success: function (data) {
                        if (data) {
                            // Render the card with the selected pet details
                            renderSelectedPetCard(data);
                        } else {
                            // If no pet is selected, clear the card content
                            clearSelectedPetCard();
                        }
                    },
                    error: function (error) {
                        console.error("Error fetching pet details:", error);
                    }
                });
            } else {
                // If no pet is selected, show the empty card
                $("#petDetails").hide();
                $("#emptyCard").show();
            }
        });

        // Function to render the card with selected pet details
        function renderSelectedPetCard(data) {
            $("#petDetails").removeClass();
            var categoryClass = data.category.toLowerCase();
            $("#petDetails").show().addClass(categoryClass);
            $("#emptyCard").hide(); // Hide the empty card
            $("#petImage").attr("src", data.image);
            $("#petName").text(data.name);
            $("#petDescription").text(data.description);
            $("#petPrice").text("Price: " + data.price);
        }

        // Function to clear the card content
        function clearSelectedPetCard() {
            $("#petImage").attr("src", "");
            $("#petName, #petDescription, #petPrice").text("");
            $("#petDetails").hide();
            $("#emptyCard").show(); // Show the empty card
        }
    });
    </script>
{% endblock %}
